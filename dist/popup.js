(()=>{"use strict";function t(t,e){let s=null;return function(...n){s&&clearTimeout(s),s=setTimeout((()=>{s=null,t(...n)}),e)}}class e{constructor(){this.preferencesInput=document.getElementById("preferences"),this.searchInput=document.getElementById("search"),this.scanButton=document.getElementById("scan"),this.stopButton=document.getElementById("stop"),this.settingsButton=document.getElementById("settings"),this.statusElement=document.getElementById("status"),this.progressSection=document.querySelector(".progress-section"),this.progressBar=document.querySelector(".progress-bar-fill"),this.progressCount=document.querySelector(".progress-count"),this.progressPercent=document.querySelector(".progress-percent"),this.currentItem=document.querySelector(".current-item"),this.initialize()}async initialize(){const t=await browser.storage.local.get(["preferences","currentSearch"]);this.preferencesInput.value=(t.preferences||[]).join(", "),this.searchInput.value=t.currentSearch||"",this.setupEventListeners()}setupEventListeners(){this.preferencesInput.addEventListener("input",t((()=>{this.updatePreferences()}),500)),this.searchInput.addEventListener("input",t((()=>{this.updateSearch()}),500)),this.scanButton.addEventListener("click",(async()=>{this.scanButton.disabled=!0,this.scanButton.style.display="none",this.stopButton.style.display="block",this.progressSection.classList.add("active"),await this.startScan()})),this.stopButton.addEventListener("click",(()=>{this.stopScan("user"),this.scanButton.disabled=!1,this.scanButton.style.display="block",this.stopButton.style.display="none",this.progressSection.classList.remove("active")})),this.settingsButton.addEventListener("click",(()=>{browser.runtime.openOptionsPage()})),browser.runtime.onMessage.addListener((t=>{"SCAN_PROGRESS"===t.type&&this.handleProgress(t.payload)}))}handleProgress(t){const{progress:e}=t,s=Math.round(e.current/e.total*100);this.progressBar.style.width=`${s}%`,this.progressCount.textContent=`${e.current}/${e.total} items`,this.progressPercent.textContent=`${s}%`,this.currentItem.textContent=e.currentItem?`Analyzing: ${e.currentItem}`:"Scanning items...",e.current===e.total&&setTimeout((()=>{this.scanButton.disabled=!1,this.scanButton.style.display="block",this.stopButton.style.display="none",this.progressSection.classList.remove("active"),this.updateStatus("Scan complete")}),1e3)}async updatePreferences(){const t=this.preferencesInput.value.split(",").map((t=>t.trim())).filter((t=>t.length>0));await browser.storage.local.set({preferences:t}),this.updateStatus("Preferences updated"),await this.broadcastMessage({type:"UPDATE_PREFERENCES",payload:{preferences:t}})}async updateSearch(){const t=this.searchInput.value.trim();await browser.storage.local.set({currentSearch:t}),this.updateStatus("Search updated"),await this.broadcastMessage({type:"UPDATE_SEARCH",payload:{search:t}})}async startScan(){const t=this.preferencesInput.value.split(",").map((t=>t.trim())).filter((t=>t.length>0)),e=this.searchInput.value.trim()||null;this.scanButton.style.display="none",this.stopButton.style.display="block",this.progressSection.classList.add("active"),this.updateStatus("Scanning items..."),await this.broadcastMessage({type:"START_SCAN",payload:{preferences:t,searchTerm:e}})}async stopScan(t){this.scanButton.style.display="block",this.stopButton.style.display="none",this.progressSection.classList.remove("active"),this.updateStatus("complete"===t?"Scan complete":"Scan stopped"),await this.broadcastMessage({type:"STOP_SCAN",payload:{reason:t}})}updateStatus(t){this.statusElement.textContent=t}async broadcastMessage(t){await browser.runtime.sendMessage(t);const e=await browser.tabs.query({url:["*://*.vinted.com/*","*://*.vinted.fr/*","*://*.vinted.de/*"]});await Promise.all(e.map((e=>{if(e.id)return browser.tabs.sendMessage(e.id,t).catch((()=>{}))})))}}document.addEventListener("DOMContentLoaded",(()=>{new e}))})();
//# sourceMappingURL=popup.js.map