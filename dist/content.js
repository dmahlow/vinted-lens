(()=>{"use strict";new class{constructor(){this.state={isEnabled:!0,isAnalyzing:!1,preferences:[],currentSearch:null},this.initialize()}async initialize(){const e=await browser.storage.local.get(["preferences","currentSearch"]);this.state.preferences=e.preferences||[],this.state.currentSearch=e.currentSearch||null,browser.runtime.onMessage.addListener(this.handleMessage.bind(this)),this.setupGridObserver(),this.checkForProductGrid()}setupGridObserver(){new MutationObserver(function(e){let t;return(...s)=>{clearTimeout(t),t=setTimeout((()=>e(...s)),500)}}((()=>{this.state.isAnalyzing||this.checkForProductGrid()}))).observe(document.body,{childList:!0,subtree:!0})}checkForProductGrid(){if(!document.querySelector(".feed-grid"))return;const e=this.getVisibleGridItems();e.length>=10&&this.analyzeGrid(e)}getVisibleGridItems(){const e=[],t=document.querySelectorAll(".feed-grid__item");return t.forEach(((t,s)=>{if(this.isElementInViewport(t)){const i={row:Math.floor(s/5),column:s%5};i.row<2&&i.column<5&&e.push({id:`item-${s}`,position:i,element:t})}})),e}isElementInViewport(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}async captureViewport(){try{const e=await browser.windows.getCurrent();if(!e.id)throw new Error("Could not determine window ID");return{screenshot:await browser.tabs.captureVisibleTab(e.id,{format:"jpeg",quality:85}),gridSize:{rows:2,columns:5}}}catch(e){return console.error("Failed to capture viewport:",e),null}}async analyzeGrid(e){if(!this.state.isAnalyzing){this.state.isAnalyzing=!0,e.forEach((e=>{e.element.classList.add("vinted-lens-analyzing")}));try{const e=await this.captureViewport();if(!e)throw new Error("Failed to capture viewport");await browser.runtime.sendMessage({type:"ANALYZE_GRID",payload:{viewport:e}})}catch(e){console.error("Failed to analyze grid:",e),this.showToast({message:"Failed to analyze items",type:"error"})}finally{this.state.isAnalyzing=!1,e.forEach((e=>{e.element.classList.remove("vinted-lens-analyzing")}))}}}handleMessage(e){switch(e.type){case"ANALYSIS_COMPLETE":this.handleAnalysisComplete(e.payload);break;case"UPDATE_PREFERENCES":this.handlePreferencesUpdate(e.payload);break;case"UPDATE_SEARCH":this.handleSearchUpdate(e.payload);break;case"SHOW_TOAST":this.showToast(e.payload)}}handleAnalysisComplete(e){const{analysis:t}=e,s=document.querySelectorAll(".feed-grid__item");t.items.forEach((e=>{const t=5*e.position.row+e.position.column,i=s[t];i&&(e.matches?(i.classList.add("vinted-lens-match"),e.confidence<.8&&i.classList.add("vinted-lens-low-confidence")):i.classList.add("vinted-lens-hidden"))}))}handlePreferencesUpdate(e){this.state.preferences=e.preferences,this.resetAnalysis()}handleSearchUpdate(e){this.state.currentSearch=e.search,this.resetAnalysis()}resetAnalysis(){document.querySelectorAll(".vinted-lens-match, .vinted-lens-hidden, .vinted-lens-low-confidence").forEach((e=>{e.classList.remove("vinted-lens-match","vinted-lens-hidden","vinted-lens-low-confidence")})),this.checkForProductGrid()}showToast(e){const t=document.createElement("div");t.className=`vinted-lens-toast ${e.type||""}`,t.textContent=e.message,document.body.appendChild(t),t.offsetHeight,t.classList.add("show"),setTimeout((()=>{t.classList.remove("show"),setTimeout((()=>t.remove()),300)}),e.duration||3e3)}}})();
//# sourceMappingURL=content.js.map